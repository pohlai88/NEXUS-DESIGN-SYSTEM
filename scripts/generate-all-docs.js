#!/usr/bin/env node
/**
 * Generate All Documentation
 * 
 * Master script that generates all auto-generated documentation
 * for the UI/Design System repository.
 * 
 * Usage: node scripts/generate-all-docs.js
 */

import { execSync } from 'child_process';
import { existsSync } from 'fs';
import { join } from 'path';

const scriptsDir = join(process.cwd(), 'scripts');
const docsDir = join(process.cwd(), 'docs');

console.log('ğŸ“š Generating all documentation...\n');

const generators = [
  {
    name: 'API Reference (Markdown)',
    script: 'generate-api-reference-md.js',
    output: 'API_REFERENCE.md',
    required: true,
    note: 'Requires api-docs.json (generated by extract:api-docs)',
  },
  {
    name: 'Token Reference',
    script: 'generate-token-docs.js',
    output: 'TOKEN_REFERENCE.md',
    required: true,
    note: 'Requires tokens.json (generated by extract:tokens)',
  },
  {
    name: 'Component Documentation',
    script: 'generate-component-docs.js',
    output: 'COMPONENTS.md',
    required: true,
    note: 'Requires components/react directory',
  },
];

let successCount = 0;
let skipCount = 0;
let errorCount = 0;

generators.forEach(({ name, script, output, required, note }) => {
  const scriptPath = join(scriptsDir, script);
  
  if (!existsSync(scriptPath)) {
    if (required) {
      console.error(`âŒ Required script not found: ${script}`);
      errorCount++;
    } else {
      console.log(`â­ï¸  Skipping ${name} (script not found: ${script})`);
      if (note) console.log(`   ${note}`);
      skipCount++;
    }
    return;
  }
  
  try {
    console.log(`ğŸ“ Generating ${name}...`);
    execSync(`node ${scriptPath}`, { stdio: 'inherit', cwd: process.cwd() });
    
    // Check if output was created (if applicable)
    if (output) {
      const outputPath = join(docsDir, output);
      if (existsSync(outputPath)) {
        console.log(`   âœ… Generated: docs/${output}\n`);
      } else {
        console.log(`   âš ï¸  Script ran but output not found: docs/${output}\n`);
      }
    } else {
      console.log(`   âœ… Completed\n`);
    }
    
    successCount++;
  } catch (error) {
    console.error(`   âŒ Error generating ${name}:`, error.message);
    if (required) {
      errorCount++;
    } else {
      skipCount++;
    }
    console.log('');
  }
});

// Summary
console.log('\nğŸ“Š Documentation Generation Summary:');
console.log(`   âœ… Success: ${successCount}`);
console.log(`   â­ï¸  Skipped: ${skipCount}`);
console.log(`   âŒ Errors: ${errorCount}`);

if (errorCount > 0) {
  console.log('\nâš ï¸  Some required documentation failed to generate!');
  process.exit(1);
} else {
  console.log('\nâœ… All documentation generated successfully!');
  console.log('\nğŸ“ Next steps:');
  console.log('   1. Review generated documentation in docs/');
  console.log('   2. Commit changes if satisfied');
  console.log('   3. Documentation will auto-generate on build');
}


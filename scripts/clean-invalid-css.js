/**
 * PostCSS plugin to remove invalid CSS classes generated by Tailwind
 * Removes classes with placeholder values like "...", "#.*?", "*"
 */

export default function cleanInvalidCss() {
  return {
    postcssPlugin: 'clean-invalid-css',
    Rule(rule) {
      const selector = rule.selector;
      
      // Remove rules with invalid selectors (regex patterns, placeholders)
      if (
        selector.includes('\\\\') || // Escaped backslashes (regex patterns)
        selector.includes('\\d+') || // Regex digit patterns
        selector.includes('[.*?]') || // Regex patterns in brackets
        selector.includes('[...]') || // Placeholder brackets
        selector.includes('[#.*?]') || // Color regex patterns
        selector.includes('[*]') // Wildcard patterns
      ) {
        rule.remove();
        return;
      }
      
      // Check if the rule has invalid property values
      rule.walkDecls((decl) => {
        const value = decl.value;
        
        // Remove declarations with placeholder values, regex patterns, or invalid CSS
        if (
          value === '...' ||
          value === '*' ||
          value === '#.*?' ||
          /^\.\.\./.test(value) ||
          /^#\.\*\?/.test(value) ||
          /\\d\+/.test(value) || // Regex patterns like \d+px
          /\\\\/.test(value) || // Escaped backslashes
          value.trim() === '' ||
          value.includes('.*?') // Regex patterns
        ) {
          decl.remove();
        }
      });
      
      // Remove empty rules
      if (rule.nodes && rule.nodes.length === 0) {
        rule.remove();
      }
    },
  };
}

cleanInvalidCss.postcss = true;

